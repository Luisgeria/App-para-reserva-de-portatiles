<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <meta name="description" content="Sistema de reserva de port√°tiles en tiempo real para CEIP Puente de Simancas">
    <meta name="theme-color" content="#16a34a">
    
    <!-- PWA Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Reserva Port√°tiles">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <title>Reserva de Port√°tiles - CEIP Puente de Simancas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&display=swap');
        
        * {
            -webkit-tap-highlight-color: transparent;
        }
        
        body { 
            font-family: 'Outfit', sans-serif; 
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            min-height: 100vh;
        }
        
        .period-card { 
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); 
            border-radius: 1.5rem; 
            border: 3px solid #bbf7d0;
            min-height: 100px;
        }
        
        .reserved { 
            background-color: #fee2e2; 
            border-color: #fca5a5; 
        }
        
        .available { 
            background-color: #ffffff; 
            cursor: pointer; 
        }
        
        .available:hover, .available:active { 
            border-color: #16a34a; 
            transform: translateY(-3px); 
            box-shadow: 0 12px 20px -5px rgba(22, 163, 74, 0.3); 
        }
        
        .modal { 
            display: none; 
            position: fixed; 
            inset: 0; 
            background: rgba(15, 23, 42, 0.7); 
            align-items: center; 
            justify-content: center; 
            z-index: 50; 
            backdrop-filter: blur(8px); 
        }
        
        .modal.active { display: flex; }
        
        .status-dot { 
            width: 10px; 
            height: 10px; 
            border-radius: 50%; 
            display: inline-block; 
            margin-right: 8px; 
            transition: background-color 0.3s; 
        }
        
        /* Banner de instalaci√≥n PWA */
        #install-banner { 
            position: fixed; 
            bottom: 20px; 
            left: 50%; 
            transform: translateX(-50%); 
            z-index: 100;
            display: none;
            animation: slideUp 0.3s ease-out;
        }
        
        #install-banner.show { display: block; }
        
        @keyframes slideUp {
            from { transform: translateX(-50%) translateY(100px); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }
        
        /* Tama√±os aumentados para m√≥vil */
        @media (max-width: 768px) {
            .period-card {
                min-height: 110px;
                padding: 1.5rem !important;
            }
            
            .text-mobile-xl {
                font-size: 1.375rem;
            }
            
            .text-mobile-lg {
                font-size: 1.125rem;
            }
            
            .text-mobile-base {
                font-size: 1rem;
            }
            
            .text-mobile-sm {
                font-size: 0.9375rem;
            }
        }

        /* Admin Modal */
        #admin-lock-btn {
            position: fixed;
            top: 16px;
            right: 16px;
            z-index: 200;
            background: rgba(255,255,255,0.85);
            border: 2px solid #bbf7d0;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 12px rgba(22,163,74,0.15);
            transition: all 0.2s;
            backdrop-filter: blur(6px);
        }
        #admin-lock-btn:hover {
            background: #f0fdf4;
            border-color: #16a34a;
            transform: scale(1.08);
            box-shadow: 0 4px 16px rgba(22,163,74,0.25);
        }
        #admin-lock-btn.admin-active {
            background: #16a34a;
            border-color: #15803d;
        }
        #admin-lock-btn.admin-active svg {
            color: white;
        }
        .admin-delete-btn {
            display: none;
        }
        .admin-mode .admin-delete-btn {
            display: inline-block;
        }
        .admin-mode .reserved {
            border-color: #f87171 !important;
        }

        /* Historial modal */
        #historial-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.7);
            align-items: flex-start;
            justify-content: center;
            z-index: 60;
            backdrop-filter: blur(8px);
            padding: 1rem;
            overflow-y: auto;
        }
        #historial-modal.active { display: flex; }
        .historial-table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
        .historial-table th {
            background: #16a34a;
            color: white;
            padding: 0.6rem 0.8rem;
            text-align: left;
            font-weight: 700;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .historial-table td {
            padding: 0.55rem 0.8rem;
            border-bottom: 1px solid #f1f5f9;
            color: #334155;
        }
        .historial-table tr:hover td { background: #f0fdf4; }
        .historial-table tr:last-child td { border-bottom: none; }
    </style>
</head>
<body class="p-5 md:p-8">
    <!-- Bot√≥n Admin (candado) -->
    <button id="admin-lock-btn" title="Acceso Administrador" onclick="openAdminLogin()">
        <svg id="lock-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
        </svg>
    </button>

    <!-- Modal Login Admin -->
    <div id="admin-login-modal" class="modal">
        <div class="bg-white w-full max-w-sm m-5 p-8 rounded-[2.5rem] shadow-2xl">
            <div class="flex items-center gap-3 mb-2">
                <div class="w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                </div>
                <h3 class="text-2xl font-black text-green-900">Acceso Admin</h3>
            </div>
            <p class="text-sm text-slate-500 mb-7 font-semibold">Introduce la contrase√±a de administrador</p>
            <div class="space-y-5">
                <div>
                    <label class="block text-xs font-bold text-green-700 uppercase mb-3 ml-1">Contrase√±a</label>
                    <input type="password" id="admin-password-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                        class="w-full text-base bg-green-50 border-2 border-green-200 rounded-2xl p-4 outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all"
                        onkeydown="if(event.key==='Enter') checkAdminPassword()">
                </div>
                <div id="admin-login-error" class="hidden text-red-500 text-sm font-bold text-center bg-red-50 py-2 px-4 rounded-xl">‚ùå Contrase√±a incorrecta</div>
                <div class="flex gap-4 pt-2">
                    <button type="button" onclick="closeAdminLogin()" 
                        class="flex-1 py-4 font-bold text-base text-slate-500 hover:text-slate-700 transition-colors">Cancelar</button>
                    <button type="button" onclick="checkAdminPassword()"
                        class="flex-1 py-4 text-base bg-green-600 text-white font-bold rounded-2xl shadow-lg hover:bg-green-700 active:scale-95 transition-all">Entrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Panel Admin -->
    <div id="admin-panel-modal" class="modal">
        <div class="bg-white w-full max-w-sm m-5 p-8 rounded-[2.5rem] shadow-2xl">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-green-500 rounded-xl flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                </div>
                <div>
                    <h3 class="text-xl font-black text-green-900">Panel Admin</h3>
                    <p class="text-xs text-green-600 font-bold">Modo administrador activo</p>
                </div>
            </div>
            <div class="space-y-3">
                <button onclick="closeAdminPanel(); openHistorial()"
                    class="w-full py-4 bg-green-50 hover:bg-green-100 text-green-800 font-bold rounded-2xl transition-all flex items-center gap-3 px-5 active:scale-95">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                    Ver historial de reservas
                </button>
                <button onclick="closeAdminPanel(); logoutAdmin()"
                    class="w-full py-4 bg-red-50 hover:bg-red-100 text-red-700 font-bold rounded-2xl transition-all flex items-center gap-3 px-5 active:scale-95">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    Salir del modo admin
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Historial -->
    <div id="historial-modal">
        <div class="bg-white w-full max-w-4xl my-4 rounded-[2.5rem] shadow-2xl overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-green-700 to-green-500 px-6 py-5 flex items-center justify-between">
                <div>
                    <h3 class="text-xl font-black text-white">üìã Historial de Reservas</h3>
                    <p class="text-green-100 text-sm font-semibold mt-0.5">Port√°tiles ¬∑ CEIP Puente de Simancas</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="exportarExcel()"
                        class="bg-white text-green-700 px-4 py-2 rounded-xl font-black text-sm hover:bg-green-50 transition-all flex items-center gap-2 active:scale-95">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Excel
                    </button>
                    <button onclick="closeHistorial()"
                        class="bg-white bg-opacity-20 text-white px-3 py-2 rounded-xl font-black text-lg hover:bg-opacity-30 transition-all leading-none active:scale-95">‚úï</button>
                </div>
            </div>
            <!-- Filtros -->
            <div class="px-6 py-4 bg-green-50 border-b border-green-100 flex flex-wrap gap-3 items-center">
                <div class="flex items-center gap-2">
                    <label class="text-xs font-bold text-slate-500 uppercase">Desde</label>
                    <input type="date" id="filtro-desde" class="bg-white border-2 border-green-200 rounded-xl px-3 py-1.5 text-sm font-semibold outline-none focus:border-green-500 transition-all">
                </div>
                <div class="flex items-center gap-2">
                    <label class="text-xs font-bold text-slate-500 uppercase">Hasta</label>
                    <input type="date" id="filtro-hasta" class="bg-white border-2 border-green-200 rounded-xl px-3 py-1.5 text-sm font-semibold outline-none focus:border-green-500 transition-all">
                </div>
                <button onclick="aplicarFiltroHistorial()" class="bg-green-600 text-white px-4 py-1.5 rounded-xl text-sm font-bold hover:bg-green-700 transition-all active:scale-95">Filtrar</button>
                <button onclick="limpiarFiltroHistorial()" class="bg-white text-slate-500 px-4 py-1.5 rounded-xl text-sm font-bold border-2 border-slate-200 hover:bg-slate-50 transition-all active:scale-95">Limpiar</button>
                <span id="historial-count" class="ml-auto text-xs font-bold text-slate-400"></span>
            </div>
            <!-- Tabla -->
            <div class="overflow-auto max-h-[60vh]">
                <div id="historial-loading" class="py-12 text-center text-green-500 font-semibold animate-pulse">Cargando historial...</div>
                <table class="historial-table hidden" id="historial-table">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Horario</th>
                            <th>Profesor/a</th>
                            <th>Curso</th>
                            <th>Reservado el</th>
                            <th>Acci√≥n</th>
                        </tr>
                    </thead>
                    <tbody id="historial-body"></tbody>
                </table>
                <div id="historial-empty" class="hidden py-12 text-center text-slate-400 font-semibold">No hay reservas en el per√≠odo seleccionado</div>
            </div>
        </div>
    </div>



    <!-- Banner de instalaci√≥n PWA -->
    <div id="install-banner" class="bg-green-600 text-white px-6 py-4 rounded-2xl shadow-2xl max-w-sm mx-4">
        <div class="flex items-center gap-4">
            <div class="flex-1">
                <p class="font-bold text-sm">üì± Instalar App</p>
                <p class="text-xs opacity-90">Accede m√°s r√°pido desde tu pantalla de inicio</p>
            </div>
            <button id="install-button" class="bg-white text-green-600 px-4 py-2 rounded-xl font-bold text-sm hover:bg-green-50 transition-all active:scale-95">
                Instalar
            </button>
            <button id="close-banner" class="text-white opacity-70 hover:opacity-100 text-xl leading-none">‚úï</button>
        </div>
    </div>

    <div class="max-w-2xl mx-auto">
        <header class="text-center mb-8">
            <div class="flex items-center justify-center gap-4 mb-3">
                <img src="data:image/png;base64,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" alt="Logo CEIP Puente de Simancas" class="h-14 md:h-16 object-contain rounded-xl shadow-sm" />
                <h1 class="text-3xl md:text-5xl font-black text-green-800 tracking-tight">CEIP Puente de Simancas</h1>
            </div>
            <div class="flex items-center justify-center gap-4">
                <span class="text-xs md:text-sm font-bold text-green-600 uppercase tracking-widest flex items-center">
                    <span id="conn-dot" class="status-dot bg-slate-300"></span> 
                    <span id="conn-text">Estableciendo conexi√≥n...</span>
                </span>
            </div>
        </header>

        <!-- Instrucciones con tonos verdes -->
        <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-3xl p-6 md:p-7 shadow-md border-2 border-green-200 mb-7">
            <h2 class="text-lg md:text-xl font-black text-green-900 mb-5 flex items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-green-600" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                </svg>
                Instrucciones de uso
            </h2>
            <ul class="space-y-4 text-mobile-sm md:text-base text-slate-700 leading-relaxed">
                <li class="flex items-start gap-3">
                    <span class="text-green-600 font-black text-xl mt-0.5">1.</span>
                    <span>Haz clic en un tramo horario <strong>disponible</strong> para reservar los port√°tiles.</span>
                </li>
                <li class="flex items-start gap-3">
                    <span class="text-green-600 font-black text-xl mt-0.5">2.</span>
                    <span>Completa tu nombre y curso en el formulario que aparece.</span>
                </li>
                <li class="flex items-start gap-3">
                    <span class="text-green-600 font-black text-xl mt-0.5">3.</span>
                    <span>Solo t√∫ podr√°s <strong>liberar</strong> tu reserva desde este dispositivo.</span>
                </li>
                <li class="flex items-start gap-3">
                    <span class="text-red-600 font-black text-xl mt-0.5">‚ö†Ô∏è</span>
                    <span><strong>Importante:</strong> Si borras los datos del navegador o cambias de dispositivo, no podr√°s liberar tu reserva.</span>
                </li>
            </ul>
        </div>

        <div class="bg-white rounded-3xl p-6 shadow-md border-2 border-green-200 mb-8 flex items-center justify-between">
            <div>
                <p class="text-xs md:text-sm font-bold text-green-600 uppercase tracking-widest mb-1">Fecha de hoy</p>
                <p id="date-display" class="text-mobile-lg md:text-xl font-bold text-green-700 capitalize">...</p>
            </div>
            <button onclick="window.location.reload()" class="p-3 bg-green-50 hover:bg-green-100 rounded-2xl text-green-700 transition-all active:scale-90">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
            </button>
        </div>

        <div id="periods-container" class="space-y-5">
            <div class="text-center py-12 text-green-500 animate-pulse text-lg font-semibold">Sincronizando horarios...</div>
        </div>

        <div class="mt-10 text-center space-y-2">
            <p class="text-xs text-green-600 font-bold uppercase tracking-widest">Base de Datos en Tiempo Real Activa</p>
            <p class="text-xs text-green-700 font-semibold">App elaborada por @luisgeria ¬∑ Enero 2026</p>
        </div>
    </div>

    <!-- Modal Reserva -->
    <div id="reserve-modal" class="modal">
        <div class="bg-white w-full max-w-md m-5 p-8 rounded-[2.5rem] shadow-2xl" id="modal-content">
            <h3 class="text-2xl md:text-3xl font-black text-green-900 mb-2">Nueva Reserva</h3>
            <p id="modal-time-label" class="text-green-600 font-bold mb-8 uppercase tracking-widest text-sm"></p>
            
            <form id="reserve-form" class="space-y-6">
                <div>
                    <label class="block text-xs md:text-sm font-bold text-green-700 uppercase mb-3 ml-1">Nombre Profesor/a</label>
                    <input type="text" id="profesor-name" required placeholder="Nombre completo" 
                        class="w-full text-base md:text-lg bg-green-50 border-2 border-green-200 rounded-2xl p-4 outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all">
                </div>
                <div>
                    <label class="block text-xs md:text-sm font-bold text-green-700 uppercase mb-3 ml-1">Curso / Grupo</label>
                    <input type="text" id="curso-name" required placeholder="Ej. 6¬∫A" 
                        class="w-full text-base md:text-lg bg-green-50 border-2 border-green-200 rounded-2xl p-4 outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all">
                </div>
                <div class="flex gap-4 pt-4">
                    <button type="button" onclick="closeModal()" 
                        class="flex-1 py-4 font-bold text-base text-slate-500 hover:text-slate-700 transition-colors">Cancelar</button>
                    <button type="submit" id="submit-btn" 
                        class="flex-1 py-4 text-base bg-green-600 text-white font-bold rounded-2xl shadow-lg hover:bg-green-700 active:scale-95 transition-all">Confirmar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- PWA Install Logic - SIN Service Worker -->
    <script>
        // Detectar si la app puede instalarse
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Mostrar banner solo en m√≥vil
            if (window.innerWidth <= 768) {
                document.getElementById('install-banner').classList.add('show');
            }
        });

        document.getElementById('install-button').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                deferredPrompt = null;
                document.getElementById('install-banner').classList.remove('show');
            }
        });

        document.getElementById('close-banner').addEventListener('click', () => {
            document.getElementById('install-banner').classList.remove('show');
        });
    </script>

    <!-- Firebase Setup -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getDatabase, ref, set, remove, onValue } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-database.js";

        // Tu configuraci√≥n de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAlW7S4tpn4YYkoov1Uq93KFmT8cY8Uzms",
            authDomain: "app-reserva-de-portatiles.firebaseapp.com",
            databaseURL: "https://app-reserva-de-portatiles-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "app-reserva-de-portatiles",
            storageBucket: "app-reserva-de-portatiles.firebasestorage.app",
            messagingSenderId: "170712420790",
            appId: "1:170712420790:web:e52d1831be2985c6af3117"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        const periods = [
            { id: 'p1', h: "09:00 - 10:00" }, 
            { id: 'p2', h: "10:00 - 11:00" }, 
            { id: 'p3', h: "11:00 - 12:00" }, 
            { id: 'p4', h: "12:30 - 13:00" },
            { id: 'p5', h: "13:00 - 13:30" }, 
            { id: 'p6', h: "13:30 - 14:00" }
        ];

        let reserves = {};
        let selectedId = null;
        let userId = null;
        const today = new Date().toISOString().split('T')[0];

        // Generar o recuperar ID √∫nico de usuario
        function getUserId() {
            let id = localStorage.getItem('userId');
            if (!id) {
                id = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('userId', id);
            }
            return id;
        }

        userId = getUserId();
        updateConnectionStatus('connecting', 'Conectando...');

        const reservasRef = ref(database, `reservas/${today}`);

        onValue(reservasRef, (snapshot) => {
            reserves = {};
            const data = snapshot.val();
            
            if (data) {
                Object.keys(data).forEach(key => {
                    reserves[data[key].slotId] = data[key];
                });
            }
            
            updateConnectionStatus('connected', 'Conectado');
            render();
        }, (error) => {
            console.error("Error de conexi√≥n:", error);
            updateConnectionStatus('error', 'Error de conexi√≥n');
            render();
        });

        function updateConnectionStatus(status, text) {
            const dot = document.getElementById('conn-dot');
            const textEl = document.getElementById('conn-text');
            
            if (status === 'connected') {
                dot.className = 'status-dot bg-green-500';
            } else if (status === 'connecting') {
                dot.className = 'status-dot bg-yellow-500';
            } else {
                dot.className = 'status-dot bg-red-500';
            }
            
            textEl.innerText = text;
        }

        function render() {
            const container = document.getElementById('periods-container');
            if (!container) return;
            container.innerHTML = '';

            periods.forEach(p => {
                const data = reserves[p.id];
                const card = document.createElement('div');
                card.className = `period-card p-6 flex items-center justify-between ${data ? 'reserved' : 'available'}`;
                
                const canLiberate = data && data.userId === userId;
                
                card.innerHTML = `
                    <div class="flex flex-col">
                        <span class="text-xs md:text-sm font-bold uppercase tracking-widest ${data ? 'text-red-500' : 'text-green-600'} mb-1">Tramo horario</span>
                        <span class="text-mobile-xl md:text-2xl font-black text-slate-800">${p.h}</span>
                    </div>
                    ${data ? `
                        <div class="text-right">
                            <p class="font-black text-slate-900 text-mobile-lg md:text-xl leading-tight mb-1">${data.profe}</p>
                            <p class="text-slate-500 text-sm md:text-base font-bold mb-2">${data.curso}</p>
                            ${canLiberate ? `
                                <button onclick="window.liberar('${p.id}')" class="mt-2 text-xs md:text-sm bg-red-100 text-red-600 px-4 py-2 rounded-xl font-black hover:bg-red-200 active:bg-red-300 transition-all uppercase tracking-tight">Liberar</button>
                            ` : `
                                <div class="mt-2 text-xs md:text-sm text-slate-400 px-4 py-2 rounded-xl font-black uppercase tracking-tight">Reservado</div>
                            `}
                            <button onclick="window.adminBorrar('${p.id}')" class="admin-delete-btn mt-1 text-xs md:text-sm bg-red-600 text-white px-4 py-2 rounded-xl font-black hover:bg-red-700 active:bg-red-800 transition-all uppercase tracking-tight">üóë Borrar (Admin)</button>
                        </div>
                    ` : `
                        <div class="bg-green-100 text-green-700 px-5 py-3 rounded-2xl font-black text-xs md:text-sm uppercase tracking-widest border-2 border-green-200">Disponible</div>
                    `}
                `;

                if (!data) card.onclick = () => openModal(p.id, p.h);
                container.appendChild(card);
            });
        }

        window.openModal = (id, label) => {
            selectedId = id;
            document.getElementById('modal-time-label').innerText = label;
            document.getElementById('reserve-modal').classList.add('active');
        };

        window.closeModal = () => {
            document.getElementById('reserve-modal').classList.remove('active');
            document.getElementById('reserve-form').reset();
            const btn = document.getElementById('submit-btn');
            btn.innerText = "Confirmar";
            btn.disabled = false;
        };

        window.liberar = async (slotId) => {
            const reserva = reserves[slotId];
            if (!reserva || reserva.userId !== userId) {
                alert('Solo quien reserv√≥ puede liberar este horario.');
                return;
            }

            if (confirm('¬øQuieres liberar este horario?')) {
                try {
                    const slotRef = ref(database, `reservas/${today}/${slotId}`);
                    await remove(slotRef);
                } catch (e) { 
                    console.error("Error liberando:", e);
                    alert("Error al liberar el horario. Intenta de nuevo.");
                }
            }
        };

        window.adminBorrar = async (slotId) => {
            if (!window.isAdminMode()) return;
            const reserva = reserves[slotId];
            if (!reserva) return;
            if (confirm(`¬øBorrar la reserva de ${reserva.profe} (${reserva.curso})?`)) {
                try {
                    const slotRef = ref(database, `reservas/${today}/${slotId}`);
                    await remove(slotRef);
                } catch (e) {
                    console.error("Error borrando (admin):", e);
                    alert("Error al borrar la reserva. Intenta de nuevo.");
                }
            }
        };

        window.renderAdmin = () => render();

        // ---- HISTORIAL PORT√ÅTILES ----
        const periodLabels = {
            'p1': '09:00 - 10:00', 'p2': '10:00 - 11:00', 'p3': '11:00 - 12:00',
            'p4': '12:30 - 13:00', 'p5': '13:00 - 13:30', 'p6': '13:30 - 14:00'
        };
        const dayNamesES = ['domingo','lunes','martes','mi√©rcoles','jueves','viernes','s√°bado'];
        let historialData = [];
        let historialFiltrado = [];

        function formatDateHist(date) {
            return date.toISOString().split('T')[0];
        }

        window.openHistorial = async () => {
            document.getElementById('historial-modal').classList.add('active');
            document.getElementById('historial-loading').classList.remove('hidden');
            document.getElementById('historial-table').classList.add('hidden');
            document.getElementById('historial-empty').classList.add('hidden');

            const hoy = new Date();
            const hace30 = new Date();
            hace30.setDate(hace30.getDate() - 30);
            document.getElementById('filtro-desde').value = formatDateHist(hace30);
            document.getElementById('filtro-hasta').value = formatDateHist(hoy);

            await cargarHistorial(formatDateHist(hace30), formatDateHist(hoy));
        };

        window.closeHistorial = () => {
            document.getElementById('historial-modal').classList.remove('active');
        };

        async function cargarHistorial(desde, hasta) {
            document.getElementById('historial-loading').classList.remove('hidden');
            document.getElementById('historial-table').classList.add('hidden');
            document.getElementById('historial-empty').classList.add('hidden');
            historialData = [];

            const { get } = await import("https://www.gstatic.com/firebasejs/11.1.0/firebase-database.js");

            try {
                const rootRef = ref(database, 'reservas');
                const snapshot = await get(rootRef);
                const data = snapshot.val() || {};

                Object.keys(data).sort().forEach(fechaKey => {
                    if (fechaKey < desde || fechaKey > hasta) return;
                    const dayData = data[fechaKey];
                    if (!dayData) return;
                    Object.values(dayData).forEach(reserva => {
                        historialData.push({
                            fecha: reserva.date || fechaKey,
                            slotId: reserva.slotId,
                            profe: reserva.profe,
                            curso: reserva.curso,
                            timestamp: reserva.timestamp,
                            userId: reserva.userId
                        });
                    });
                });

                historialData.sort((a,b) => {
                    if (a.fecha !== b.fecha) return a.fecha > b.fecha ? -1 : 1;
                    return (a.slotId || '') > (b.slotId || '') ? 1 : -1;
                });

                historialFiltrado = [...historialData];
                renderHistorial();
            } catch(e) {
                console.error('Error cargando historial:', e);
                document.getElementById('historial-loading').classList.add('hidden');
                document.getElementById('historial-empty').classList.remove('hidden');
                document.getElementById('historial-empty').textContent = 'Error al cargar el historial.';
            }
        }

        function renderHistorial() {
            document.getElementById('historial-loading').classList.add('hidden');
            const tbody = document.getElementById('historial-body');
            tbody.innerHTML = '';

            if (historialFiltrado.length === 0) {
                document.getElementById('historial-empty').classList.remove('hidden');
                document.getElementById('historial-count').textContent = '0 reservas';
                return;
            }

            document.getElementById('historial-table').classList.remove('hidden');
            document.getElementById('historial-count').textContent = historialFiltrado.length + ' reservas';

            historialFiltrado.forEach(r => {
                const fechaObj = new Date(r.fecha + 'T12:00:00');
                const diaSemana = dayNamesES[fechaObj.getDay()];
                const fechaDisplay = fechaObj.toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric' });
                const horaDisplay = r.timestamp ? new Date(r.timestamp).toLocaleString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' }) : '-';
                const periodoLabel = periodLabels[r.slotId] || r.slotId;
                const tr = document.createElement('tr');
                tr.innerHTML =
                    '<td class="font-bold text-slate-700">' + fechaDisplay + ' <span class="text-slate-400 font-normal capitalize text-xs">(' + diaSemana + ')</span></td>' +
                    '<td class="font-semibold text-green-700">' + periodoLabel + '</td>' +
                    '<td class="font-bold text-slate-800">' + r.profe + '</td>' +
                    '<td class="text-slate-600 font-semibold">' + r.curso + '</td>' +
                    '<td class="text-slate-400 text-xs">' + horaDisplay + '</td>' +
                    '<td><button onclick="adminBorrarDesdeHistorial(' + JSON.stringify(r.fecha) + ',' + JSON.stringify(r.slotId) + ')" ' +
                    'class="text-xs bg-red-100 text-red-600 px-3 py-1 rounded-xl font-black hover:bg-red-200 transition-all uppercase">üóë Borrar</button></td>';
                tbody.appendChild(tr);
            });
        }

        window.aplicarFiltroHistorial = () => {
            const desde = document.getElementById('filtro-desde').value;
            const hasta = document.getElementById('filtro-hasta').value;
            if (desde && hasta) cargarHistorial(desde, hasta);
        };

        window.limpiarFiltroHistorial = () => {
            const hoy = new Date();
            const hace30 = new Date();
            hace30.setDate(hace30.getDate() - 30);
            document.getElementById('filtro-desde').value = formatDateHist(hace30);
            document.getElementById('filtro-hasta').value = formatDateHist(hoy);
            cargarHistorial(formatDateHist(hace30), formatDateHist(hoy));
        };

        window.adminBorrarDesdeHistorial = async (fecha, slotId) => {
            if (!window.isAdminMode()) return;
            const idx = historialFiltrado.findIndex(r => r.fecha === fecha && r.slotId === slotId);
            const reserva = idx >= 0 ? historialFiltrado[idx] : null;
            const nombre = reserva ? reserva.profe + ' (' + reserva.curso + ')' : slotId;
            if (confirm('¬øBorrar la reserva de ' + nombre + ' el ' + fecha + '?')) {
                try {
                    const slotRef = ref(database, 'reservas/' + fecha + '/' + slotId);
                    await remove(slotRef);
                    if (idx >= 0) historialFiltrado.splice(idx, 1);
                    const idxMain = historialData.findIndex(r => r.fecha === fecha && r.slotId === slotId);
                    if (idxMain >= 0) historialData.splice(idxMain, 1);
                    renderHistorial();
                } catch(e) {
                    console.error('Error borrando desde historial:', e);
                    alert('Error al borrar la reserva.');
                }
            }
        };

        window.exportarExcel = () => {
            if (historialFiltrado.length === 0) { alert('No hay datos para exportar.'); return; }
            const cabecera = ['Fecha','D√≠a semana','Horario','Profesor/a','Curso','Reservado el'];
            const filas = historialFiltrado.map(r => {
                const fechaObj = new Date(r.fecha + 'T12:00:00');
                const diaSemana = dayNamesES[fechaObj.getDay()];
                const fechaDisplay = fechaObj.toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric' });
                const horaDisplay = r.timestamp ? new Date(r.timestamp).toLocaleString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' }) : '';
                const periodo = periodLabels[r.slotId] || r.slotId;
                return [fechaDisplay, diaSemana, periodo, r.profe, r.curso, horaDisplay].map(v => '"' + String(v).replace(/"/g, '""') + '"').join(';');
            });
            const csv = '\uFEFF' + [cabecera.join(';'), ...filas].join('\n');
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            const desde = document.getElementById('filtro-desde').value || 'inicio';
            const hasta = document.getElementById('filtro-hasta').value || 'hoy';
            link.href = url;
            link.download = 'historial_portatiles_' + desde + '_' + hasta + '.csv';
            link.click();
            URL.revokeObjectURL(url);
        };
        // ---- FIN HISTORIAL ----

        document.getElementById('reserve-form').onsubmit = async (e) => {
            e.preventDefault();

            const btn = document.getElementById('submit-btn');
            btn.innerText = "Guardando...";
            btn.disabled = true;

            try {
                const reserva = {
                    slotId: selectedId,
                    date: today,
                    profe: document.getElementById('profesor-name').value,
                    curso: document.getElementById('curso-name').value,
                    timestamp: Date.now(),
                    userId: userId
                };

                const slotRef = ref(database, `reservas/${today}/${selectedId}`);
                await set(slotRef, reserva);
                closeModal();
            } catch (err) {
                console.error("Error al guardar:", err);
                alert("Error al guardar la reserva. Verifica tu conexi√≥n.");
                btn.innerText = "Reintentar";
                btn.disabled = false;
            }
        };

        document.getElementById('date-display').innerText = new Date().toLocaleDateString('es-ES', { 
            weekday: 'long', 
            day: 'numeric', 
            month: 'long' 
        });
    </script>

    <!-- Admin Logic -->
    <script>
        const ADMIN_PASSWORD = '11223344';
        let isAdminMode = false;

        function openAdminLogin() {
            if (isAdminMode) {
                document.getElementById('admin-panel-modal').classList.add('active');
            } else {
                document.getElementById('admin-password-input').value = '';
                document.getElementById('admin-login-error').classList.add('hidden');
                document.getElementById('admin-login-modal').classList.add('active');
                setTimeout(() => document.getElementById('admin-password-input').focus(), 100);
            }
        }

        function closeAdminLogin() {
            document.getElementById('admin-login-modal').classList.remove('active');
        }

        function closeAdminPanel() {
            document.getElementById('admin-panel-modal').classList.remove('active');
        }

        function checkAdminPassword() {
            const pw = document.getElementById('admin-password-input').value;
            if (pw === ADMIN_PASSWORD) {
                isAdminMode = true;
                closeAdminLogin();
                activateAdminMode();
            } else {
                document.getElementById('admin-login-error').classList.remove('hidden');
                document.getElementById('admin-password-input').value = '';
                document.getElementById('admin-password-input').focus();
            }
        }

        function activateAdminMode() {
            document.getElementById('admin-lock-btn').classList.add('admin-active');
            document.getElementById('periods-container').classList.add('admin-mode');
            // Rerender to show delete buttons - trigger a re-render by calling the exposed render
            if (typeof window.renderAdmin === 'function') window.renderAdmin();
        }

        function logoutAdmin() {
            isAdminMode = false;
            document.getElementById('admin-lock-btn').classList.remove('admin-active');
            document.getElementById('periods-container').classList.remove('admin-mode');
            if (typeof window.renderAdmin === 'function') window.renderAdmin();
        }

        window.isAdminMode = () => isAdminMode;
    </script>
</body>
</html>
